<script>
    /**
     * APEX v10.1 DYNAMIC PATH RESOLVER
     * Automatically detects environment to prevent 'MANIFEST_NOT_FOUND'
     */
    const getManifestUrl = () => {
        const isGithubPages = window.location.hostname.includes('github.io');
        const repoName = '/CYBERDUDEBIVASH-THREAT-INTEL-PLATFORM/';
        
        // If on GitHub Pages, use the absolute path including the repo name
        // If local, use the relative path
        return isGithubPages 
            ? `${window.location.origin}${repoName}data/stix/feed_manifest.json`
            : './data/stix/feed_manifest.json';
    };

    async function loadTacticalIntel() {
        const grid = document.getElementById('threat-grid');
        const syncVal = document.getElementById('sync-val');
        const MANIFEST_URL = getManifestUrl();
        
        try {
            const response = await fetch(MANIFEST_URL);
            if (!response.ok) throw new Error(`HTTP_ERR_${response.status}`);
            
            const data = await response.json();
            
            if (data.length === 0) {
                grid.innerHTML = '<div class="error-msg">NODE EMPTY: NO ACTIVE CAMPAIGNS</div>';
                return;
            }

            grid.innerHTML = data.reverse().map(item => `
                <div class="intel-card">
                    <div style="font-size: 9px; color: #444; margin-bottom: 15px;">ID: ${item.stix_id}</div>
                    <h3 style="margin: 0; font-size: 18px; color: #fff;">${item.title}</h3>
                    <p style="font-size: 13px; color: #777; margin: 15px 0;">Risk Severity: ${item.risk_score}/10</p>
                    <a href="${item.blog_url}" target="_blank" class="view-link">View Tactical Dossier &rarr;</a>
                </div>`).join('');

            syncVal.innerText = 'LATEST';
            syncVal.style.color = 'var(--apex-green)';
        } catch (err) {
            console.error("APEX Sync Failure:", err);
            grid.innerHTML = `
                <div class="error-msg">
                    ðŸš¨ GOC MANIFEST SYNC FAILURE<br>
                    <span style="font-size:10px; font-weight:normal; color:#666;">
                        CHECK: ${MANIFEST_URL}
                    </span>
                </div>`;
            syncVal.innerText = 'OFFLINE';
            syncVal.style.color = 'var(--tlp-red)';
        }
    }
    window.onload = loadTacticalIntel;
</script>
