<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDB Sentinel APEX | Tactical Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono&display=swap');
        
        body { background-color: #050505; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); }
        .amber-glow { border-left: 4px solid #ffbf00; background: linear-gradient(90deg, rgba(255,191,0,0.08) 0%, transparent 100%); }
        .clear-glow { border-left: 4px solid #00d4aa; background: linear-gradient(90deg, rgba(0,212,170,0.08) 0%, transparent 100%); }
        .cyber-grid { background-image: radial-gradient(#1a1a1a 1px, transparent 1px); background-size: 30px 30px; }
        
        /* Tactical Heatmap Transitions */
        .tactic-card { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .tactic-active { border-color: #00d4aa; color: #00d4aa; box-shadow: 0 0 15px rgba(0, 212, 170, 0.2); }
    </style>
</head>
<body class="cyber-grid min-h-screen p-6 md:p-12">

    <header class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-start md:items-center mb-16 gap-6">
        <div>
            <h1 class="text-5xl font-black italic tracking-tighter text-white">SENTINEL<span class="text-[#00d4aa]">APEX</span></h1>
            <p class="text-[10px] uppercase tracking-[0.5em] text-white/30 font-bold mt-2">CyberDudeBivash Pvt. Ltd. // GOC Infrastructure</p>
        </div>
        <div id="engine-status" class="glass px-8 py-4 rounded-2xl flex items-center gap-4">
            <div class="relative flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[#00d4aa] opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-[#00d4aa]"></span>
            </div>
            <div>
                <span class="block text-[10px] font-black uppercase tracking-widest text-[#00d4aa]">System Operational</span>
                <span id="last-sync" class="block text-[9px] text-white/20 font-mono italic">Syncing...</span>
            </div>
        </div>
    </header>

    <section class="max-w-7xl mx-auto mb-16">
        <div class="glass rounded-[2.5rem] p-10 relative overflow-hidden">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-2xl font-black italic tracking-tighter uppercase">Tactical Heatmap</h2>
                <span class="text-[9px] font-black text-white/20 uppercase tracking-[0.3em]">MITRE ATT&CKÂ® v14 Frame</span>
            </div>
            <div id="mitre-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                </div>
        </div>
    </section>

    <section class="max-w-7xl mx-auto">
        <div class="glass rounded-[2.5rem] overflow-hidden shadow-2xl">
            <table class="w-full text-left border-collapse">
                <thead class="bg-white/5 text-[10px] font-black uppercase tracking-[0.2em] text-white/30">
                    <tr>
                        <th class="p-8">Intelligence Node</th>
                        <th class="p-8">Classification</th>
                        <th class="p-8">Forensic Assets</th>
                        <th class="p-8 text-right">Ingestion</th>
                    </tr>
                </thead>
                <tbody id="feed-body" class="divide-y divide-white/5 text-sm font-medium">
                    </tbody>
            </table>
        </div>
    </section>

    <script>
        const manifestPath = 'data/stix/feed_manifest.json';

        async function init() {
            try {
                const response = await fetch(manifestPath);
                const data = await response.json();
                
                // Update Sync Status
                document.getElementById('last-sync').innerText = `Last Sync: ${new Date(data.last_updated).toLocaleString()}`;

                // 1. Render MITRE Heatmap (Dynamic logic)
                const grid = document.getElementById('mitre-grid');
                const matrixTactics = [
                    "Initial Access", "Execution", "Persistence", "Privilege Escalation",
                    "Defense Evasion", "Credential Access", "Discovery", "Lateral Movement",
                    "Command and Control", "Exfiltration", "Impact"
                ];

                grid.innerHTML = '';
                matrixTactics.forEach(tactic => {
                    const isActive = data.active_tactics.includes(tactic);
                    grid.insertAdjacentHTML('beforeend', `
                        <div class="tactic-card glass p-6 rounded-2xl border-t-4 ${isActive ? 'tactic-active' : 'border-white/5 text-white/10 opacity-40'} text-center">
                            <i class="fas ${isActive ? 'fa-fire-alt' : 'fa-shield-halved'} mb-4 text-lg"></i>
                            <p class="text-[8px] font-black uppercase tracking-widest leading-tight">${tactic}</p>
                        </div>
                    `);
                });

                // 2. Render Threat Table with TLP Logic
                const tableBody = document.getElementById('feed-body');
                tableBody.innerHTML = '';
                
                data.files.forEach(node => {
                    const isAmber = node.tlp === 'AMBER';
                    const rowClass = isAmber ? 'amber-glow' : 'clear-glow';
                    const riskColor = node.risk_score >= 7.5 ? 'text-red-500' : (node.risk_score >= 5.0 ? 'text-yellow-500' : 'text-[#00d4aa]');

                    tableBody.insertAdjacentHTML('beforeend', `
                        <tr class="hover:bg-white/[0.03] transition-all group ${rowClass}">
                            <td class="p-8">
                                <span class="font-black text-white/90 block mb-1">${node.name}</span>
                                <div class="flex gap-2">
                                    ${node.tactics.map(t => `<span class="text-[8px] text-white/30 uppercase border border-white/10 px-2 py-0.5 rounded">${t}</span>`).join('')}
                                </div>
                            </td>
                            <td class="p-8">
                                <span class="text-[10px] font-black px-3 py-1 rounded-full ${isAmber ? 'bg-yellow-500/20 text-yellow-500' : 'bg-[#00d4aa]/20 text-[#00d4aa]'}">
                                    ${node.tlp}
                                </span>
                                <span class="ml-3 font-mono text-xs ${riskColor}">${node.risk_score.toFixed(1)}</span>
                            </td>
                            <td class="p-8">
                                ${node.pdf ? `
                                    <a href="data/whitepapers/${node.pdf}" target="_blank" class="text-[#00d4aa] hover:text-white transition flex items-center gap-2">
                                        <i class="fas fa-file-pdf"></i>
                                        <span class="text-[10px] font-black uppercase">Technical Advisory</span>
                                    </a>
                                ` : '<span class="text-white/10 text-[10px] italic">No Advisory Found</span>'}
                            </td>
                            <td class="p-8 text-right">
                                <a href="data/stix/${node.name}" target="_blank" class="px-6 py-3 bg-white/5 hover:bg-white hover:text-black rounded-xl text-[10px] font-black uppercase tracking-widest transition-all">
                                    Ingest STIX 2.1
                                </a>
                            </td>
                        </tr>
                    `);
                });

            } catch (error) {
                console.error('APEX DASHBOARD SYNC ERROR:', error);
                document.getElementById('feed-body').innerHTML = `<tr><td colspan="4" class="p-20 text-center text-red-500 font-black tracking-widest uppercase">GOC Manifest Sync Failure // Check Data/STIX/ Repository</td></tr>`;
            }
        }

        window.onload = init;
    </script>
</body>
</html>
